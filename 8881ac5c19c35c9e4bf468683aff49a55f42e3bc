{
  "comments": [
    {
      "key": {
        "uuid": "bc7d2f55_029b8aff",
        "filename": "gerrit-owners-autoassign/src/main/java/com/vmware/gerrit/owners/common/ReviewerManager.java",
        "patchSetId": 5
      },
      "lineNbr": 27,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2016-10-21T20:22:17Z",
      "side": 1,
      "message": "Well, that\u0027s messy. We stop using REST endpoints directly years ago and replaced the approach with the Plugin API. Instead of trying to inject all the stuff needed to call PostReviewers endpoint on your own, you supposed to just use the Plugin API, something like (untested):\n\n  private final GerritApi gApi;\n  @Inject\n  public ReviewerManager(GerritApi gApi) {\n    this.gApi \u003d gApi;\n  }\n  public void addReviewers(Change change, Collection\u003cAccount.Id\u003e reviewers) {\n    try {\n      ChangeApi cApi \u003d gApi.changes().id(change.getId().get());\n      for (Account.Id account : reviewers) {\n        cApi.addReviewer(account.toString());\n      }\n    } catch (RestApiException e) {\n      log.error(\"Couldn\u0027t add reviewers to the change\", e);\n      throw new ReviewerManagerException(e);\n    }\n  }\n\nDone. Something similar is done in my reviewers plugin: [1].\n\n* [1] https://github.com/davido/gerrit-reviewers-plugin/blob/master/src/main/java/com/googlesource/gerrit/plugins/reviewers/DefaultReviewers.java#L57-L72",
      "revId": "8881ac5c19c35c9e4bf468683aff49a55f42e3bc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c112fc46_1a7d1d25",
        "filename": "gerrit-owners-autoassign/src/main/java/com/vmware/gerrit/owners/common/ReviewerManager.java",
        "patchSetId": 5
      },
      "lineNbr": 27,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2016-10-21T23:30:22Z",
      "side": 1,
      "message": "Agreed, much simpler and more stable with future Gerrit changes :-)",
      "parentUuid": "bc7d2f55_029b8aff",
      "revId": "8881ac5c19c35c9e4bf468683aff49a55f42e3bc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c112fc46_9a524d7d",
        "filename": "gerrit-owners-autoassign/src/main/java/com/vmware/gerrit/owners/common/ReviewerManager.java",
        "patchSetId": 5
      },
      "lineNbr": 27,
      "author": {
        "id": 1023193
      },
      "writtenOn": "2016-10-23T21:36:52Z",
      "side": 1,
      "message": "I did the needed modifications.",
      "parentUuid": "bc7d2f55_029b8aff",
      "revId": "8881ac5c19c35c9e4bf468683aff49a55f42e3bc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "01fb34f7_bcce6114",
        "filename": "gerrit-owners-autoassign/src/main/java/com/vmware/gerrit/owners/common/ReviewerManager.java",
        "patchSetId": 5
      },
      "lineNbr": 27,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2016-10-27T08:54:36Z",
      "side": 1,
      "message": "Well, the GerritApi seem to assume to be only executed by interactive users :-( which is kind of unexpected.\n\nSee the blast below when using it during a Git event:\n\njava.lang.UnsupportedOperationException: AnonymousUser is not an IdentifiedUser\n        at com.google.gerrit.server.CurrentUser.asIdentifiedUser(CurrentUser.java:107)\n        at com.google.gerrit.server.change.ChangeResource.getUser(ChangeResource.java:72)\n        at com.google.gerrit.server.change.PostReviewers.apply(PostReviewers.java:152)\n        at com.google.gerrit.server.api.changes.ChangeApiImpl.addReviewer(ChangeApiImpl.java:315)\n        at com.google.gerrit.server.api.changes.ChangeApiImpl.addReviewer(ChangeApiImpl.java:309)\n        at com.vmware.gerrit.owners.common.ReviewerManager.addReviewers(ReviewerManager.java:33)\n        at com.vmware.gerrit.owners.common.GitRefListener.processEvent(GitRefListener.java:86)\n        at com.vmware.gerrit.owners.common.GitRefListener.onGitReferenceUpdated(GitRefListener.java:66)\n        at com.google.gerrit.server.extensions.events.GitReferenceUpdated.fire(GitReferenceUpdated.java:145)\n        at com.google.gerrit.server.extensions.events.GitReferenceUpdated.fire(GitReferenceUpdated.java:131)\n        at com.google.gerrit.server.extensions.events.GitReferenceUpdated.fire(GitReferenceUpdated.java:124)\n        at com.google.gerrit.server.git.BatchUpdate.execute(BatchUpdate.java:442)\n        at com.google.gerrit.server.git.BatchUpdate.execute(BatchUpdate.java:647)\n        at com.google.gerrit.server.git.BatchUpdate.execute(BatchUpdate.java:642)\n        at com.google.gerrit.server.git.ReceiveCommits.insertChangesAndPatchSets(ReceiveCommits.java:859)\n        at com.google.gerrit.server.git.ReceiveCommits.processCommands(ReceiveCommits.java:602)\n        at com.google.gerrit.server.git.AsyncReceiveCommits$Worker.run(AsyncReceiveCommits.java:89)\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)",
      "parentUuid": "bc7d2f55_029b8aff",
      "revId": "8881ac5c19c35c9e4bf468683aff49a55f42e3bc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "bc7d2f55_22908ed7",
        "filename": "gerrit-owners/src/main/java/com/vmware/gerrit/owners/OwnerPredicateProvider.java",
        "patchSetId": 5
      },
      "lineNbr": 21,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2016-10-21T20:22:17Z",
      "side": 1,
      "message": "Unsure, but shouldn\u0027t this rather be a Provider\u003cReviewDb\u003e? See this change where Provider\u003cReviewDb\u003e was removed form AccountResolver: [1].\n\n* [1] https://gerrit-review.googlesource.com/82851",
      "range": {
        "startLine": 21,
        "startChar": 32,
        "endLine": 21,
        "endChar": 40
      },
      "revId": "8881ac5c19c35c9e4bf468683aff49a55f42e3bc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a117c836_197d2b25",
        "filename": "gerrit-owners/src/main/java/com/vmware/gerrit/owners/OwnerPredicateProvider.java",
        "patchSetId": 5
      },
      "lineNbr": 21,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2016-10-21T23:30:22Z",
      "side": 1,
      "message": "Oh yes, as it is injected in a provider itself.",
      "parentUuid": "bc7d2f55_22908ed7",
      "range": {
        "startLine": 21,
        "startChar": 32,
        "endLine": 21,
        "endChar": 40
      },
      "revId": "8881ac5c19c35c9e4bf468683aff49a55f42e3bc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a117c836_b9d2bfe5",
        "filename": "gerrit-owners/src/main/java/com/vmware/gerrit/owners/OwnerPredicateProvider.java",
        "patchSetId": 5
      },
      "lineNbr": 21,
      "author": {
        "id": 1023193
      },
      "writtenOn": "2016-10-23T21:36:52Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "bc7d2f55_22908ed7",
      "range": {
        "startLine": 21,
        "startChar": 32,
        "endLine": 21,
        "endChar": 40
      },
      "revId": "8881ac5c19c35c9e4bf468683aff49a55f42e3bc",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}