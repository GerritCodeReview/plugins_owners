{
  "comments": [
    {
      "key": {
        "uuid": "166114e2_67eaaaeb",
        "filename": "README.md",
        "patchSetId": 19
      },
      "lineNbr": 52,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2017-12-21T09:19:48Z",
      "side": 1,
      "message": "You wrote \u0027:all\u0027 in the commit message. Typo?",
      "range": {
        "startLine": 52,
        "startChar": 14,
        "endLine": 52,
        "endChar": 17
      },
      "revId": "1f17008468383171f949328020a23a94cd402345",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "04ebf340_d8e8798f",
        "filename": "README.md",
        "patchSetId": 19
      },
      "lineNbr": 52,
      "author": {
        "id": 1019328
      },
      "writtenOn": "2017-12-21T11:48:36Z",
      "side": 1,
      "message": "Done.",
      "parentUuid": "166114e2_67eaaaeb",
      "range": {
        "startLine": 52,
        "startChar": 14,
        "endLine": 52,
        "endChar": 17
      },
      "revId": "1f17008468383171f949328020a23a94cd402345",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f782ce93_823b6709",
        "filename": "README.md",
        "patchSetId": 19
      },
      "lineNbr": 59,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2017-12-21T09:19:48Z",
      "side": 1,
      "message": "I was expecting the jar created with the standalone build to be the same of the ones generated with an in-tree build with the same version of Gerrit. It seems this is not the case :-(\n\nI see differences with the Jackson files included in the fat-jar and the class files generated by the Prolog build are actually different.\n\nExample of standalone class file:\ngerrit_owners/PRED_$dummy_0_owners$002Fsrc$002Fmain$002Fprolog$002Fgerrit_owners$002Epl_1.class\n\nExample of in-tree class file:\n gerrit_owners/PRED_$dummy_0_plugins$002Fowners$002Fsrc$002Fmain$002Fprolog$002Fgerrit_owners$002Epl_1.class\n\nIs this expected? What would be the impact on the functionality?",
      "range": {
        "startLine": 58,
        "startChar": 0,
        "endLine": 59,
        "endChar": 54
      },
      "revId": "1f17008468383171f949328020a23a94cd402345",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "af79d6ed_ca14c046",
        "filename": "README.md",
        "patchSetId": 19
      },
      "lineNbr": 59,
      "author": {
        "id": 1019328
      },
      "writtenOn": "2017-12-21T11:48:36Z",
      "side": 1,
      "message": "Yes, there are slight differences in some of the Prolog classes mostly due to the path differences (the \u0027plugins\u0027 part) which are expected IMHO. For the Jackson files I do not have an explanation (David?) but functionality wise the artifacts produced by the standalone build are behaving as expected, at least for the 5 examples given in the documentation.",
      "parentUuid": "f782ce93_823b6709",
      "range": {
        "startLine": 58,
        "startChar": 0,
        "endLine": 59,
        "endChar": 54
      },
      "revId": "1f17008468383171f949328020a23a94cd402345",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "dd14237d_10ccd017",
        "filename": "README.md",
        "patchSetId": 19
      },
      "lineNbr": 59,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2017-12-21T12:00:12Z",
      "side": 1,
      "message": "Yes, I agree with Hector, that generated prolog class name doesn\u0027t matter.\n\n\u003e For the Jackson files I do not have an explanation (David?)\n\nI don\u0027t have access to my machine atm. Can you paste the differences from standalone and in gerrit tree build concerning Jackson?",
      "parentUuid": "af79d6ed_ca14c046",
      "range": {
        "startLine": 58,
        "startChar": 0,
        "endLine": 59,
        "endChar": 54
      },
      "revId": "1f17008468383171f949328020a23a94cd402345",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "76223b51_e8fb6955",
        "filename": "README.md",
        "patchSetId": 19
      },
      "lineNbr": 59,
      "author": {
        "id": 1019328
      },
      "writtenOn": "2017-12-21T12:17:17Z",
      "side": 1,
      "message": "For what I see, the differences are in the jackson_core artifact only and this one is the only common with the jackson dependencies declared in gerrit\u0027s lib/jackson/BUILD. Given they are different in version between the declared in external_plugin_dependencies (2.1.1) and the one declared by Gerrit (2.6.6), my guess is that we are packing the gerrit\u0027s declared newer version of jackson-core when building in tree. Would that be possible?",
      "parentUuid": "dd14237d_10ccd017",
      "range": {
        "startLine": 58,
        "startChar": 0,
        "endLine": 59,
        "endChar": 54
      },
      "revId": "1f17008468383171f949328020a23a94cd402345",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "024a936f_f101b517",
        "filename": "README.md",
        "patchSetId": 19
      },
      "lineNbr": 59,
      "author": {
        "id": 1019328
      },
      "writtenOn": "2017-12-21T12:28:54Z",
      "side": 1,
      "message": "Seems to be the case. Just for the sake of testing, I modified external_plugin_deps.bzl in order to use the same 2.6.6 jackson-core version declared in Gerrit and the Jackson libraries are now identical between standalone build and in-tree. Seems we were always using the Gerrit declared version when building in-tree?",
      "parentUuid": "76223b51_e8fb6955",
      "range": {
        "startLine": 58,
        "startChar": 0,
        "endLine": 59,
        "endChar": 54
      },
      "revId": "1f17008468383171f949328020a23a94cd402345",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "60d5aae8_7d3d48a5",
        "filename": "README.md",
        "patchSetId": 19
      },
      "lineNbr": 59,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2017-12-21T12:53:32Z",
      "side": 1,
      "message": "Yes, we have dependency collision! Ut was worth it to implement standalone build to detect it ;-)\n\nElasticsearch depends on jackson:\n\n   WORKSPACE:JACKSON_VERSION \u003d \"2.8.9\"\n\non master:\n\n    \"//lib/jackson:jackson-core\",\n    \"//lib/jackson:jackson-dataformat-cbor\",\n    \"//lib/jackson:jackson-dataformat-smile\",\n\nwhile the owners plugin depends on 2.1.1. Gerrit doesn\u0027t support different version of the same jar. What should happen is (in its own change):\n\n* 1. Synchronize Jackson-core Versions between core and owners plugin\n* 2.. Stop shipping jackson-core.jar in the plugin, because it is already available in gerrit core. This can be easily achieved, by depending on jackson-core:neverlink jar, that is exposed by our maven_jar rule.",
      "parentUuid": "024a936f_f101b517",
      "range": {
        "startLine": 58,
        "startChar": 0,
        "endLine": 59,
        "endChar": 54
      },
      "revId": "1f17008468383171f949328020a23a94cd402345",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6488e3a1_06b81c82",
        "filename": "README.md",
        "patchSetId": 19
      },
      "lineNbr": 59,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2017-12-21T14:05:02Z",
      "side": 1,
      "message": "Good catch David and Hector.\nCan we externalise the JACKSON_VERSION and get it automatically from the target Gerrit version?\nAnd, of course as you said, prevent his inclusion in the final jar file.",
      "parentUuid": "60d5aae8_7d3d48a5",
      "range": {
        "startLine": 58,
        "startChar": 0,
        "endLine": 59,
        "endChar": 54
      },
      "revId": "1f17008468383171f949328020a23a94cd402345",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5ac062f8_30b5835b",
        "filename": "README.md",
        "patchSetId": 19
      },
      "lineNbr": 59,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2017-12-21T14:22:40Z",
      "side": 1,
      "message": "Unfortunately, now, that we want to provide standalone build we cannot consume JACKSON_VERSION from any place, because standalone build per definition doesn\u0027t know anything except bazlets, that know nothing about Jackson.\n\nI\u0027m afraid, the best thing we can do, is adapt the Jackson version on corresponding gerrit stable branches.\n\nOf course the better approach would be to eliminate that decency altogether and only reliy on Gson.",
      "parentUuid": "6488e3a1_06b81c82",
      "range": {
        "startLine": 58,
        "startChar": 0,
        "endLine": 59,
        "endChar": 54
      },
      "revId": "1f17008468383171f949328020a23a94cd402345",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "cd4741c8_0884daee",
        "filename": "README.md",
        "patchSetId": 19
      },
      "lineNbr": 59,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2017-12-21T14:24:37Z",
      "side": 1,
      "message": "Good idea: does Gson support YAML?",
      "parentUuid": "5ac062f8_30b5835b",
      "range": {
        "startLine": 58,
        "startChar": 0,
        "endLine": 59,
        "endChar": 54
      },
      "revId": "1f17008468383171f949328020a23a94cd402345",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7bd46619_ab6a9a27",
        "filename": "README.md",
        "patchSetId": 19
      },
      "lineNbr": 59,
      "author": {
        "id": 1011323
      },
      "writtenOn": "2017-12-21T14:31:37Z",
      "side": 1,
      "message": "Unfortunately, it does not: [1] ;-(\n\n* [1] https://github.com/google/gson/issues/327",
      "parentUuid": "cd4741c8_0884daee",
      "range": {
        "startLine": 58,
        "startChar": 0,
        "endLine": 59,
        "endChar": 54
      },
      "revId": "1f17008468383171f949328020a23a94cd402345",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "02b40a20_f5bd8d81",
        "filename": "README.md",
        "patchSetId": 19
      },
      "lineNbr": 59,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2017-12-21T14:46:40Z",
      "side": 1,
      "message": "The only reason why Jackson is included is to parse the OWNERS YAML file ... if Gson doesn\u0027t support YAML then it is not an option.\n\nWhat about then including //lib/jackson:jackson-core:neverlink as you suggested and then using the VERSION declared there for the external deps?\nFor the standalone build, you could just add that file from the Gerrit tree into the Owners project.",
      "parentUuid": "7bd46619_ab6a9a27",
      "range": {
        "startLine": 58,
        "startChar": 0,
        "endLine": 59,
        "endChar": 54
      },
      "revId": "1f17008468383171f949328020a23a94cd402345",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "86523174_81feeffb",
        "filename": "README.md",
        "patchSetId": 19
      },
      "lineNbr": 59,
      "author": {
        "id": 1019328
      },
      "writtenOn": "2017-12-21T15:42:32Z",
      "side": 1,
      "message": "For the moment, I implemented David\u0027s original suggestion [1] [2] but I went with updating all the Jackson dependencies to the same version Gerrit 2.14 is using (2.6.6)\n\n[1] https://gerrit-review.googlesource.com/c/plugins/owners/+/149530\n[2] https://gerrit-review.googlesource.com/c/plugins/owners/+/149531",
      "parentUuid": "02b40a20_f5bd8d81",
      "range": {
        "startLine": 58,
        "startChar": 0,
        "endLine": 59,
        "endChar": 54
      },
      "revId": "1f17008468383171f949328020a23a94cd402345",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    }
  ]
}